openapi: 3.0.3
info:
  title: Api Order
  description: API RESTful para gerenciamento de pedidos de uma pastelaria. Versão construída com Laravel. Documentação OpenAPI 3.0.
  version: "1.0.0"
servers:
  - url: https://api.example.com/api/v1
    description: Production
  - url: http://localhost:8000/api/v1
    description: Local

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:

    Client:
      type: object
      required:
        - name
        - email
      properties:
        id:
          type: integer
          example: 12
        name:
          type: string
          example: "João da Silva"
        email:
          type: string
          format: email
          example: "joao@example.com"
        phone:
          type: string
          example: "+55 11 91234-5678"
        birth_date:
          type: string
          format: date
          example: "1990-05-10"
        address:
          type: string
          example: "Rua das Flores, 123"
        address2:
          type: string
          example: "Apto 45"
        neighborhood:
          type: string
          example: "Centro"
        zip:
          type: string
          example: "01234-567"
        registered_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Product:
      type: object
      required:
        - name
        - price
        - photo_path
        - product_type_id
      properties:
        id:
          type: integer
          example: 5
        name:
          type: string
          example: "Pastel de Queijo"
        price:
          type: number
          format: float
          minimum: 0.01
          example: 6.50
        photo_path:
          type: string
          example: "products/pastel-123.jpg"
        product_type_id:
          type: integer
          example: 1
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    OrderItem:
      type: object
      required:
        - product_id
        - quantity
        - unit_price
      properties:
        product_id:
          type: integer
          example: 5
        quantity:
          type: integer
          example: 2
          minimum: 1
        unit_price:
          type: number
          format: float
          example: 6.50
        subtotal:
          type: number
          format: float
          example: 13.00

    Order:
      type: object
      required:
        - client_id
        - products
      properties:
        id:
          type: integer
          example: 20
        client_id:
          type: integer
          example: 12
        products:
          type: array
          items:
            $ref: "#/components/schemas/OrderItem"
        total:
          type: number
          format: float
          example: 29.50
        created_at:
          type: string
          format: date-time

  responses:
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Resource not found"
    ValidationError:
      description: Validation failed
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: "The given data was invalid."
              errors:
                type: object
                example:
                  email:
                    - "The email field is required."
    ConflictError:
      description: Conflict (duplicate)
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Email already exists."

paths:

  /clients:
    get:
      tags: [Clients]
      summary: List clients (paginated)
      parameters:
        - name: q
          in: query
          schema:
            type: string
          description: Search by name or email
        - name: page
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Paginated clients
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Client'
                  meta:
                    type: object
        '401':
          description: Unauthorized
    post:
      tags: [Clients]
      summary: Create a client
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name,email]
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                phone:
                  type: string
                birth_date:
                  type: string
                  format: date
                address:
                  type: string
                address2:
                  type: string
                neighborhood:
                  type: string
                zip:
                  type: string
              example:
                name: "Maria Pereira"
                email: "maria@example.com"
                phone: "+55 11 98888-7777"
                birth_date: "1992-10-01"
                address: "Rua A, 100"
                zip: "01234-567"
      responses:
        '201':
          description: Client created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Client'
        '409':
          $ref: '#/components/responses/ConflictError'
        '422':
          $ref: '#/components/responses/ValidationError'

  /clients/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
    get:
      tags: [Clients]
      summary: Get client by id
      responses:
        '200':
          description: Client found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Client'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Clients]
      summary: Update client (full)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Client'
      responses:
        '200':
          description: Client updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Client'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
        '409':
          $ref: '#/components/responses/ConflictError'
    patch:
      tags: [Clients]
      summary: Update client (partial)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Client'
      responses:
        '200':
          description: Client patched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Client'
    delete:
      tags: [Clients]
      summary: Soft delete client
      responses:
        '204':
          description: Deleted

  /clients/{id}/orders:
    get:
      tags: [Clients, Orders]
      summary: List orders for a client
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Paginated orders
          content:
            application/json:
              schema:
                type: object

  /products:
    get:
      tags: [Products]
      summary: List products
      responses:
        '200':
          description: Paginated products
          content:
            application/json:
              schema:
                type: object
    post:
      tags: [Products]
      summary: Create a product (photo required)
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [name, price, photo, product_type_id]
              properties:
                name:
                  type: string
                price:
                  type: number
                  format: float
                  minimum: 0.01
                product_type_id:
                  type: integer
                photo:
                  type: string
                  format: binary
              example:
                name: "Pastel de Frango"
                price: 7.00
                product_type_id: 1
      responses:
        '201':
          description: Product created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '422':
          $ref: '#/components/responses/ValidationError'

  /products/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
    get:
      tags: [Products]
      summary: Get product
      responses:
        '200':
          description: Product found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Products]
      summary: Update product (include optional photo)
      requestBody:
        required: false
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                name:
                  type: string
                price:
                  type: number
                product_type_id:
                  type: integer
                photo:
                  type: string
                  format: binary
      responses:
        '200':
          description: Product updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
    delete:
      tags: [Products]
      summary: Delete (soft) product
      responses:
        '204':
          description: Deleted

  /orders:
    get:
      tags: [Orders]
      summary: List orders
      responses:
        '200':
          description: Paginated orders
          content:
            application/json:
              schema:
                type: object
    post:
      tags: [Orders]
      summary: Create an order (N products)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [client_id, products]
              properties:
                client_id:
                  type: integer
                products:
                  type: array
                  minItems: 1
                  items:
                    type: object
                    required: [product_id, quantity]
                    properties:
                      product_id:
                        type: integer
                      quantity:
                        type: integer
                        minimum: 1
              example:
                client_id: 12
                products:
                  - product_id: 5
                    quantity: 2
                  - product_id: 7
                    quantity: 1
      responses:
        '201':
          description: Order created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '422':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'

  /orders/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
    get:
      tags: [Orders]
      summary: Get order by id
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Orders]
      summary: Soft delete order
      responses:
        '204':
          description: Deleted

tags:
  - name: Clients
    description: Operations about clients
  - name: Products
    description: Operations about products (photo required on create)
  - name: Orders
    description: Operations about orders; after create an e-mail is dispatched to the client

# Example error responses (422 / 409 / 404)
x-examples:
  validationError:
    summary: Example Validation Error 422
    value:
      message: "The given data was invalid."
      errors:
        email:
          - "The email must be a valid email address."
        products:
          - "The products field is required."
  conflictError:
    summary: Example Conflict 409
    value:
      message: "Email already exists."
  notFound:
    summary: Example 404
    value:
      message: "Resource not found."
